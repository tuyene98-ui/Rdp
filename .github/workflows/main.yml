name: Windows-RDP-Full-8H

on:
  workflow_dispatch:

jobs:
  build:
    name: RDP Online 8 Hours
    runs-on: windows-latest
    timeout-minutes: 480   # 8 hours

    steps:
    - name: Step 1 ‚Äî Enable Remote Desktop
      run: |
        Write-Host "========== ENABLE RDP =========="
        Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" `
          -Name "fDenyTSConnections" -Value 0

        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
        Write-Host "RDP Enabled Successfully"

        Write-Host "Setting Password..."
        net user runneradmin Runner@123
        Write-Host "Password Updated: Runner@123"

    - name: Step 2 ‚Äî Install Chocolatey & Software
      run: |
        Write-Host "========== INSTALL SOFTWARE =========="
        Set-ExecutionPolicy Bypass -Scope Process -Force
        Invoke-WebRequest https://community.chocolatey.org/install.ps1 -UseBasicParsing | Invoke-Expression

        choco install googlechrome -y
        choco install 7zip -y
        choco install vscode -y
        choco install nodejs -y

        Write-Host "Software Installed Successfully"

    - name: Step 3 ‚Äî Set Wallpaper
      run: |
        Write-Host "========== SET WALLPAPER =========="
        $wall = "$env:TEMP\wallpaper.jpg"
        Invoke-WebRequest -Uri "https://i.imgur.com/0Z7GH9M.jpeg" -OutFile $wall

        reg add "HKCU\Control Panel\Desktop" /v Wallpaper /t REG_SZ /d $wall /f
        RUNDLL32.EXE user32.dll,UpdatePerUserSystemParameters

        Write-Host "Wallpaper Applied"

    - name: Step 4 ‚Äî Display RDP Login Info
      run: |
        $ip = (Invoke-WebRequest -Uri "https://api.ipify.org").Content

        Write-Host ""
        Write-Host "======================================="
        Write-Host "             üîê RDP LOGIN INFO         "
        Write-Host "======================================="
        Write-Host "Public IP     : $ip"
        Write-Host "Username      : runneradmin"
        Write-Host "Password      : Runner@123"
        Write-Host "Session Time  : 8 Hours"
        Write-Host "======================================="
        Write-Host ""

    - name: Step 5 ‚Äî Keep Session Alive (8 Hours)
      run: |
        Write-Host "========== KEEP ALIVE =========="
        Write-Host "RDP session will stay alive for 8 hours..."
        Start-Sleep -Seconds 28800
        Write-Host "Session Ended After 8 Hours"
