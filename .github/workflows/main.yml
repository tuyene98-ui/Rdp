name: GREENBOYM Cloud PC

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Start Ubuntu
        run: |
          sudo apt update
          sudo apt install -y xrdp xfce4 xfce4-goodies
          sudo systemctl enable xrdp
          sudo systemctl start xrdp

      - name: Create user pcuser (fix password bug)
        run: |
          sudo userdel -r pcuser 2>/dev/null || true
          sudo useradd -m -s /bin/bash pcuser
          echo "pcuser:123456" | sudo chpasswd --crypt-method=SHA512
          sudo usermod -aG sudo pcuser

      - name: Expand disk to full size (125GB)
        run: |
          sudo growpart /dev/sda 1 || true
          sudo resize2fs /dev/sda1 || true

      - name: Allow RDP port 3389
        run: |
          sudo ufw allow 3389 || true
          sudo ufw disable || true

      - name: Install desktop & browser
        run: |
          sudo apt install -y firefox vlc gnome-terminal

      - name: Show connection info
        run: |
          echo "======================================="
          echo " ðŸ“Œ *GREENBOYM* CLOUD PC READY!"
          echo " ðŸ”Œ RDP USER : pcuser"
          echo " ðŸ”‘ PASSWORD : 123456"
          echo "======================================="

      - name: Keep alive for 6 hours
        run: |
          echo "PC ONLINE FOR 6 HOURS..."
          sleep 21600
